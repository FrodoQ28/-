using System;
using System.Collections.Generic;

namespace HW_playersDataBase
{
    internal class Program
    {
        static void Main(string[] args)
        {
            const string CommandAddPlayer = "1";
            const string CommandRemovePlayer = "2";
            const string CommandBanPlayer = "3";
            const string CommandUnbanPlayer = "4";
            const string CommandExit = "5";

            bool isRunning = true;

            DataBase dataBase = new DataBase();
            List<Player> players = new List<Player>()
            {
                new Player(0, "Tom"),
                new Player(2, "Max"),
                new Player(5, "Nagibator2018")
            };

            while (isRunning)
            {
                Console.Clear();
                Console.WriteLine("База данных игроков.");

                dataBase.ShowAllPlayers(players);

                Console.WriteLine($"{new string('-', 120)}\n" +
                                  $"Добавить игрока - {CommandAddPlayer}\n" +
                                  $"Удалить игрока - {CommandRemovePlayer}\n" +
                                  $"Забанить игрока - {CommandBanPlayer}\n" +
                                  $"Разбанить игрока - {CommandUnbanPlayer}\n" +
                                  $"Закрыть программу - {CommandExit}\n" +
                                  $"Введите номер команды: ");

                switch (Console.ReadLine())
                {
                    case CommandAddPlayer:
                        dataBase.AddPlayer(players);
                        break;

                    case CommandRemovePlayer:
                        dataBase.RemovePlayer(players);
                        break;

                    case CommandBanPlayer:
                        dataBase.ChangePlayerBanStatus(players, true);
                        break;

                    case CommandUnbanPlayer:
                        dataBase.ChangePlayerBanStatus(players, false);
                        break;

                    case CommandExit:
                        isRunning = false;
                        break;
                    default:
                        Console.WriteLine("Такой томанды нет.");
                        break;
                }
            }
        }
    }

    class DataBase
    {
        public void ShowAllPlayers(List<Player> players)
        {
            int extensionNumber = 1;

            foreach (var player in players)
                Console.WriteLine($"{players.IndexOf(player) + extensionNumber}. {player.Name}, уровень {player.Level}, ID - {player.IdentificationNumber}, статус бана - {player.IsBanned}.");
        }

        public void AddPlayer(List<Player> players)
        {
            int extensionNumber = 1;

            Console.Write("Введите ник игрока: ");
            string name = Console.ReadLine();
            Console.WriteLine("Введите уровень игрока: ");

            if (int.TryParse(Console.ReadLine(), out int level)) { }
            else
                level = 1;

            players.Add(new Player(level, name));

            Console.WriteLine($"Игрок под ником {players[players.Count - extensionNumber].Name}, {players[players.Count - extensionNumber].Level} уровня добавлен.");
            Console.ReadKey();
        }

        public void ChangePlayerBanStatus(List<Player> players, bool isBanned, int errorCode = -1)
        {
            int playerIndex = GetPlayerIndex(players);

            if (playerIndex != errorCode)
            {
                players[playerIndex].IsBanned = isBanned;

                Console.WriteLine($"Игрок под ником {players[playerIndex].Name}, {players[playerIndex].Level} уровня, статус бана - {players[playerIndex].IsBanned}.");
                Console.ReadKey();
            }
        }

        public void RemovePlayer(List<Player> players, int errorCode = -1)
        {
            int playerIndex = GetPlayerIndex(players);

            if (playerIndex != errorCode)
            {
                Console.WriteLine($"Игрок под ником {players[playerIndex].Name}, {players[playerIndex].Level} уровня удален.");

                players.RemoveAt(playerIndex);

                Console.ReadKey();
            }
        }

        public int GetPlayerIndex(List<Player> players, int errorCode = -1)
        {
            Console.WriteLine("Введите ID игрока: ");

            if (int.TryParse(Console.ReadLine(), out int identificationNumber))
                foreach (var player in players)
                    if (player.IdentificationNumber == identificationNumber)
                        return players.IndexOf(player);

            Console.WriteLine("Некорректный ввод.");
            Console.ReadKey();

            return errorCode;
        }
    }

    class Player
    {
        private static int s_identifications;

        public Player(int level, string name)
        {
            Level = level;
            Name = name;
            IsBanned = false;
            IdentificationNumber = ++s_identifications;
        }

        public int IdentificationNumber { get; private set; }
        public int Level { get; private set; }
        public string Name { get; private set; }
        public bool IsBanned { get; set; }
    }
}
